<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giải pt bậc hai - Vi-ét (bấm giải)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
        }
        body {
            background: #f5f7fa;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .card {
            max-width: 800px;
            width: 100%;
            background: #ffffff;
            border-radius: 28px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.03);
            padding: 30px 28px;
            border: 1px solid #e9edf2;
        }
        h1 {
            font-size: 2rem;
            font-weight: 500;
            color: #1e293b;
            text-align: center;
            margin-bottom: 8px;
        }
        .sub {
            text-align: center;
            color: #475569;
            margin-bottom: 30px;
            font-style: italic;
            border-bottom: 1px solid #dde3ed;
            padding-bottom: 16px;
        }
        .tab-bar {
            display: flex;
            gap: 8px;
            background: #f1f4f9;
            padding: 5px;
            border-radius: 60px;
            margin-bottom: 28px;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px 10px;
            border-radius: 40px;
            background: transparent;
            border: none;
            font-size: 1.1rem;
            font-weight: 500;
            color: #334155;
            cursor: pointer;
            transition: 0.2s;
        }
        .tab.active {
            background: #ffffff;
            color: #0f172a;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .pane {
            display: none;
        }
        .pane.active {
            display: block;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            margin-bottom: 6px;
            color: #1e2b3a;
            font-weight: 500;
        }
        .input-group input {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid #d1d9e6;
            border-radius: 20px;
            font-size: 1rem;
            background: #fafdff;
            transition: 0.15s;
        }
        .input-group input:focus {
            outline: none;
            border-color: #7f8fa6;
            background: #ffffff;
        }
        .calc-btn {
            background: #1e2b37;
            color: white;
            border: none;
            padding: 16px 24px;
            width: 100%;
            border-radius: 40px;
            font-size: 1.15rem;
            font-weight: 500;
            cursor: pointer;
            margin: 18px 0 8px;
            transition: background 0.2s;
        }
        .calc-btn:hover {
            background: #111c26;
        }
        .result {
            margin-top: 30px;
            background: #f8fafc;
            border-radius: 24px;
            padding: 22px;
            border-left: 5px solid #1e2b37;
        }
        .step {
            background: white;
            border-radius: 18px;
            padding: 16px 18px;
            margin-bottom: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.01);
        }
        .step strong {
            color: #144272;
            display: inline-block;
            min-width: 110px;
            font-weight: 600;
        }
        .error-message {
            color: #b91c1c;
            background: #ffe6e6;
            padding: 14px 18px;
            border-radius: 20px;
        }
        hr {
            border: none;
            border-top: 1px dashed #cbd5e1;
            margin: 24px 0 16px;
        }
        .note {
            background: #ecf1f7;
            border-radius: 20px;
            padding: 16px 20px;
            font-size: 0.95rem;
            color: #253545;
            margin-top: 18px;
        }
        .note code {
            background: #d7e0e9;
            padding: 3px 8px;
            border-radius: 30px;
        }
        .footnote {
            margin-top: 20px;
            color: #5f6c80;
            font-size: 0.9rem;
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>PHƯƠNG TRÌNH BẬC HAI</h1>
        <div class="sub">Định lý Vi-ét</div>

        <!-- Tab chọn chế độ -->
        <div class="tab-bar">
            <button class="tab active" id="tabBasic">Cơ bản</button>
            <button class="tab" id="tabAdvanced">Nâng cao (m)</button>
        </div>

        <!-- Pane Cơ bản -->
        <div class="pane active" id="paneBasic">
            <div class="input-group">
                <label>Hệ số a (a ≠ 0)</label>
                <input type="number" step="any" id="aBasic" value="2">
            </div>
            <div class="input-group">
                <label>Hệ số b</label>
                <input type="number" step="any" id="bBasic" value="-5">
            </div>
            <div class="input-group">
                <label>Hệ số c</label>
                <input type="number" step="any" id="cBasic" value="3">
            </div>
            <button class="calc-btn" id="solveBasic">Giải phương trình</button>
            <div id="basicResult" class="result">
                <!-- Kết quả sẽ hiển thị ở đây -->
            </div>
        </div>

        <!-- Pane Nâng cao (tham số m) -->
        <div class="pane" id="paneAdvanced">
            <div class="input-group">
                <label>Biểu thức a(m) (a ≠ 0)</label>
                <input type="text" id="aExpr" value="m+1">
            </div>
            <div class="input-group">
                <label>Biểu thức b(m)</label>
                <input type="text" id="bExpr" value="-(m+1)">
            </div>
            <div class="input-group">
                <label>Biểu thức c(m)</label>
                <input type="text" id="cExpr" value="m">
            </div>
            <div class="input-group">
                <label>Giá trị của m (số thực)</label>
                <input type="number" step="any" id="mVal" value="3">
            </div>
            <button class="calc-btn" id="solveAdvanced">Giải phương trình</button>
            <div id="advResult" class="result">
                <!-- Kết quả nâng cao -->
            </div>
        </div>

        <!-- Ghi chú -->
        <hr>
        <div class="note">
            <p><strong>Chú thích:</strong></p>
            <p>• Nhập dữ liệu, sau đó bấm nút "Giải phương trình" để xem kết quả.</p>
            <p>• Số được hiển thị gọn: nếu là số nguyên thì bỏ phần thập phân, nếu không thì làm tròn 4 chữ số.</p>
            <p>• Ở chế độ nâng cao, biểu thức chỉ được phép gồm: số, <code>+ - * / ^ ( )</code> và biến <code>m</code>. Dấu <code>^</code> là lũy thừa.</p>
            <p><strong>Định lý Vi-ét:</strong> S = –b/a ; P = c/a.</p>
        </div>
        <div class="footnote">
            nguyễn tấn tài
        </div>
    </div>

    <script>
        // ---------- CHUYỂN TAB ----------
        const tabBasic = document.getElementById('tabBasic');
        const tabAdvanced = document.getElementById('tabAdvanced');
        const paneBasic = document.getElementById('paneBasic');
        const paneAdvanced = document.getElementById('paneAdvanced');

        tabBasic.addEventListener('click', () => {
            tabBasic.classList.add('active');
            tabAdvanced.classList.remove('active');
            paneBasic.classList.add('active');
            paneAdvanced.classList.remove('active');
        });

        tabAdvanced.addEventListener('click', () => {
            tabAdvanced.classList.add('active');
            tabBasic.classList.remove('active');
            paneAdvanced.classList.add('active');
            paneBasic.classList.remove('active');
        });

        // ---------- HÀM ĐỊNH DẠNG SỐ (bỏ .0 nếu nguyên, nếu không thì 4 chữ số) ----------
        function formatNumber(x) {
            if (x === null || x === undefined || isNaN(x)) return '?';
            // Làm tròn 12 chữ số để tránh sai số
            let rounded = Math.round(x * 1e12) / 1e12;
            // Nếu gần với số nguyên (sai số nhỏ hơn 1e-10) thì hiển thị nguyên
            if (Math.abs(rounded - Math.round(rounded)) < 1e-10) {
                return Math.round(rounded).toString();
            }
            // Ngược lại, hiển thị với 4 chữ số thập phân
            return rounded.toFixed(4).replace(/\.0+$/, '');
        }

        // ---------- HÀM KIỂM TRA BIỂU THỨC HỢP LỆ ----------
        function isValidExpr(expr) {
            const pattern = /^[0-9\+\-\*\/\^\(\)\.m\s]+$/;
            return pattern.test(expr);
        }

        // ---------- TÍNH BIỂU THỨC VỚI m ----------
        function evalExpr(expr, mVal) {
            let prepared = expr.replace(/\^/g, '**').replace(/m/g, `(${mVal})`);
            try {
                const fn = new Function(`return (${prepared})`);
                const result = fn();
                if (typeof result !== 'number' || isNaN(result) || !isFinite(result)) return null;
                return result;
            } catch (e) {
                return null;
            }
        }

        // ---------- HÀM TẠO CHUỖI PHƯƠNG TRÌNH ĐẸP ----------
        function equationString(a, b, c) {
            let str = formatNumber(a) + ' x² ';
            if (b >= 0) str += '+ ' + formatNumber(b) + ' x ';
            else str += '- ' + formatNumber(-b) + ' x ';
            if (c >= 0) str += '+ ' + formatNumber(c);
            else str += '- ' + formatNumber(-c);
            str += ' = 0';
            return str;
        }

        // ---------- HÀM HIỂN THỊ KẾT QUẢ CHI TIẾT ----------
        function renderQuadraticSteps(a, b, c, isAdvanced = false, mInfo = null) {
            let html = '';

            if (isAdvanced && mInfo !== null) {
                html += `<div class="step"><strong>Đề bài:</strong> m = ${formatNumber(mInfo)}</div>`;
                html += `<div class="step"><strong>Bước 1:</strong> Thay m → a = ${formatNumber(a)}, b = ${formatNumber(b)}, c = ${formatNumber(c)}<br>`;
                html += `Phương trình: ${equationString(a, b, c)}</div>`;
            } else {
                html += `<div class="step"><strong>Phương trình:</strong> ${equationString(a, b, c)}</div>`;
            }

            if (Math.abs(a) < 1e-12) {
                html += `<div class="error-message">Hệ số a phải khác 0.</div>`;
                return html;
            }

            let delta = b * b - 4 * a * c;
            html += `<div class="step"><strong>Bước 2:</strong> Δ = b² – 4ac = ${formatNumber(b)}² – 4·${formatNumber(a)}·${formatNumber(c)} = ${formatNumber(delta)}</div>`;

            if (delta < 0) {
                html += `<div class="step"><strong>Bước 3:</strong> Δ < 0 → Phương trình vô nghiệm thực.</div>`;
                html += `<div class="step"><strong>Định lý Vi-ét:</strong> Không áp dụng (vô nghiệm thực).</div>`;
            } else if (delta === 0) {
                let x = -b / (2 * a);
                html += `<div class="step"><strong>Bước 3:</strong> Δ = 0 → nghiệm kép:<br>`;
                html += `x₁ = x₂ = –b/(2a) = ${formatNumber(x)}</div>`;
                let S = -b / a;
                let P = c / a;
                html += `<div class="step"><strong>Định lý Vi-ét:</strong> S = –b/a = ${formatNumber(S)} , P = c/a = ${formatNumber(P)}</div>`;
            } else {
                let sqrtDelta = Math.sqrt(delta);
                let x1 = (-b - sqrtDelta) / (2 * a);
                let x2 = (-b + sqrtDelta) / (2 * a);
                html += `<div class="step"><strong>Bước 3:</strong> Δ > 0 → hai nghiệm phân biệt:<br>`;
                html += `x₁ = [–b – √Δ] / (2a) = ${formatNumber(x1)} <br>`;
                html += `x₂ = [–b + √Δ] / (2a) = ${formatNumber(x2)}</div>`;
                let S = -b / a;
                let P = c / a;
                html += `<div class="step"><strong>Định lý Vi-ét:</strong> S = –b/a = ${formatNumber(S)} , P = c/a = ${formatNumber(P)}</div>`;
            }
            return html;
        }

        // ---------- XỬ LÝ GIẢI CƠ BẢN ----------
        document.getElementById('solveBasic').addEventListener('click', () => {
            const a = parseFloat(document.getElementById('aBasic').value);
            const b = parseFloat(document.getElementById('bBasic').value);
            const c = parseFloat(document.getElementById('cBasic').value);
            const resultDiv = document.getElementById('basicResult');
            if (isNaN(a) || isNaN(b) || isNaN(c)) {
                resultDiv.innerHTML = `<div class="error-message">Vui lòng nhập đủ hệ số.</div>`;
                return;
            }
            resultDiv.innerHTML = renderQuadraticSteps(a, b, c, false);
        });

        // ---------- XỬ LÝ GIẢI NÂNG CAO ----------
        document.getElementById('solveAdvanced').addEventListener('click', () => {
            const aExpr = document.getElementById('aExpr').value.trim();
            const bExpr = document.getElementById('bExpr').value.trim();
            const cExpr = document.getElementById('cExpr').value.trim();
            const mVal = parseFloat(document.getElementById('mVal').value);
            const resultDiv = document.getElementById('advResult');

            if (!aExpr || !bExpr || !cExpr) {
                resultDiv.innerHTML = `<div class="error-message">Vui lòng nhập biểu thức.</div>`;
                return;
            }
            if (isNaN(mVal)) {
                resultDiv.innerHTML = `<div class="error-message">Giá trị m không hợp lệ.</div>`;
                return;
            }
            if (!isValidExpr(aExpr) || !isValidExpr(bExpr) || !isValidExpr(cExpr)) {
                resultDiv.innerHTML = `<div class="error-message">Biểu thức chỉ được chứa: số, + - * / ^ ( ) và m.</div>`;
                return;
            }

            let a = evalExpr(aExpr, mVal);
            let b = evalExpr(bExpr, mVal);
            let c = evalExpr(cExpr, mVal);
            if (a === null || b === null || c === null) {
                resultDiv.innerHTML = `<div class="error-message">Lỗi tính toán (chia 0 hoặc biểu thức sai).</div>`;
                return;
            }

            resultDiv.innerHTML = renderQuadraticSteps(a, b, c, true, mVal);
        });

        // Khởi tạo ví dụ mẫu (không tự động tính, chỉ hiển thị ô trống hoặc hướng dẫn)
        // Có thể để trống, hoặc hiển thị một thông báo nhẹ
        window.onload = function() {
            // Không tự động tính, chỉ để hướng dẫn
            document.getElementById('basicResult').innerHTML = `<div class="step">Nhập hệ số và bấm "Giải phương trình".</div>`;
            document.getElementById('advResult').innerHTML = `<div class="step">Nhập biểu thức và bấm "Giải phương trình".</div>`;
        };
    </script>
</body>
</html>
